<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Jan EkstrÃ¸m & Contributors" /><link rel="canonical" href="https://ibm.github.io/maximo-labs/adjust_script/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>3. Adjust and run Node-RED script - Monitor Node-RED CSV Importer Lab</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "3. Adjust and run Node-RED script";
        var mkdocs_page_input_path = "adjust_script.md";
        var mkdocs_page_url = "/maximo-labs/adjust_script/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Monitor Node-RED CSV Importer Lab
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="" href="../..">Get back to Maximo Labs</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitor Node-RED CSV Importer Lab</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Welcome</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../prereqs/">Pre-Requisites</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Exercises</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../setup/">1. Setup environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../get_script/">2. Get Node-RED script</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">3. Adjust and run Node-RED script</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#create-the-monitor-device-type">Create the Monitor Device type</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inject-and-verify-1-row-of-data">Inject and verify 1 row of data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inject-historical-data-from-csv-files">Inject historical data from CSV file(s)</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../release_notes/">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../copyright">Copyright</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Monitor Node-RED CSV Importer Lab</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Exercises</li>
      <li class="breadcrumb-item active">3. Adjust and run Node-RED script</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="objectives">Objectives</h1>
<p>In this Exercise you will learn how to:</p>
<ul>
<li>Create the Monitor Device type using Monitor API</li>
<li>Inject and verify 1 row of data</li>
<li>Inject historical data from CSV file(s)</li>
</ul>
<hr />
<p><em>Before you begin:</em><br />
This Exercise requires that you:</p>
<ol>
<li>Have completed the pre-requisites required for <a href="../prereqs/">all labs AND Exercise 3</a></li>
<li>Have completed the <a href="../setup/">setup of Node-RED locally</a></li>
<li>Have <a href="../get_script/">imported the Node-RED script</a></li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>You need the credentials described in the <a href="../prereqs/">Exercise 3 section in Pre-Requites</a></br>
before proceeding with this exercise.</p>
</div>
<p>The Node-RED script includes 5 steps which are shown with comment nodes in the script:</p>
<ol>
<li>Create generic flow data in the "Set Flow Data" function node</li>
<li>Create Asset Table in DB2 using the Monitor API</li>
<li>Inject 1 row of data into the table to verify it works</li>
<li>Update the "Fomat SQL" function node in step 5 to reflect step 3</li>
<li>Upload CSV data to SQL database using the UI uploader</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also find the description of the 5 steps within the flow in textual form.</br>
Simply double-click to open the INFORMATION node:</br></br>
<img alt="View Information" src="../img/Adjust_00.png" /></br></br></p>
</div>
<p></br></p>
<hr />
<h2 id="create-the-monitor-device-type">Create the Monitor Device type</h2>
<p>This section describes how to use the Monitor API to create the demo pump device in Monitor without using the IoT Tool.</p>
<ol>
<li>Open Node-RED in your browser if not done already.</li>
<li>Find and open the "Set Flow Data" node in Step 1.
<img alt="Find node" src="../img/Adjust_01.png" /></br></br></li>
<li>Enter the Monitor API URL <code>monitorAPIURL</code>, the API Key <code>x_api_key</code> and API Token <code>x_api_token</code></br>
as defined in the <a href="../prereqs/">Pre-Requites</a>.</br>
Replace XX with your initials in line 5 and 7. Press <code>Done</code>.
<img alt="Enter credentials" src="../img/Adjust_02.png" /></br>
The metricTimestampColumn in the "Set Flow Data" function node tells Monitor which column should be used as timestamp, which is important when injecting historical data.</br>
The metrics are already adjusted to contain the same columns as in Pump CSV data files that you will use later in the lab.</br></br></li>
<li>Deploy the script and if you enterred the correct credentials you should see the below message at <a href="http://localhost:1880/ui" target="_blank">Node-RED Dashboard</a> (unless the DEMO_PUMP table has already been created).
<img alt="Verify connection to Monitor" src="../img/Adjust_03.png" /></br></br></li>
<li>Step 2 is really easy, as it only requires you to click on the inject node called "Create Table".
<img alt="Create Table" src="../img/Adjust_04.png" /></br></br></li>
<li>Navigate to the <a href="http://localhost:1880/ui" target="_blank">Dashboard</a> once the <code>requesting</code> status of the <code>http request</code> node is gone.
<img alt="Table Created" src="../img/Adjust_05.png" /></br></br></li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The order and names of the metrics MUST be the same as in the CSV file!!</p>
</div>
<p></br></p>
<h2 id="inject-and-verify-1-row-of-data">Inject and verify 1 row of data</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use the Maximo Monitor application to verify that the Device type has been created.</br>
However I will be using <a href="https://dbeaver.io/download/" target="_blank">DBeaver Community Edition</a> during this lab.</br>
Now you should be able to see the DEMO_PUMP tables have been created:</br></br>
<img alt="View Information" src="../img/Adjust_10.png" /></br></br></p>
</div>
<p></br></p>
<ol>
<li>Find and open the "MAS (8.6)" dashDB In node in Step 3.
<img alt="Find node" src="../img/Adjust_11.png" /></br></br></li>
<li>Click on the pencil to edit the Server data.
<img alt="Edit Server" src="../img/Adjust_12.png" /></br></br></li>
<li>Enter the credentials to the DB2 Warehouse server and press <code>Update</code> and then <code>Done</code>.
<img alt="Edit Server" src="../img/Adjust_13.png" /></br></br></li>
<li>Find and open the "Format SQL" function node.
<img alt="Find node" src="../img/Adjust_14.png" /></br></br></li>
<li>Scroll down and you will see two sections where you can enter data.</br>
The first <code>"line"</code> section is populated with some simulated data which is in the same order as the CSV file data you will be using soon.
The second section is where the SQL statement is being created which will be used to inject that data into the DB2 Warehouse.</br>
You can leave these sections untouched for now, as this excercise will use the provided CSV files that matches that data set - Click on <code>Done</code> or <code>Cancel</code> to close the function node.
<img alt="Describe Sections" src="../img/Adjust_15.png" /></br></br></li>
<li>Deploy the script and click on the <code>Inject 1 row</code> inject node.
<img alt="Inject 1 row" src="../img/Adjust_16.png" /></br></br></li>
<li>My first try failed due to wrong password as you can see in the debug pane.</br>
The second attempt was successful as shown in the red box.</br>
You can also see the actual complete SQL statement that was send to the database. This might help you when you want to experiment with your own data set after you have completed this lab.
<img alt="Inject 1 row" src="../img/Adjust_17.png" /></br></br></li>
<li>And you can also verify that the data was injected into the database using DBeaver.
<img alt="Show 1 row in DBeaver" src="../img/Adjust_18.png" /></br></br></li>
</ol>
<h2 id="inject-historical-data-from-csv-files">Inject historical data from CSV file(s)</h2>
<p>Now is the time you have been waiting for ;-)</br></br>
You will be using the two csv files which was downloaded together with the Node-RED script</br>
(in your Downloads folder). Please remember that location.</br>
The first three steps of the total of five is done and you will now execute the last two steps.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The uploadSql and the chunks-to-lines nodes makes it possible to handle rather large data sets as they make sure the data set is handled in smaller chunks to avoid memory issues - but at the same time ingest 2048 rows into the database at the time (it seems to be a good number from a performance and error avoidance perspective).</p>
</div>
<ol>
<li>As you can see in the script Step 4 is about copying the second section from <code>Format SQL</code> in Step 3 to <code>Format SQL</code> in Step 5.
<img alt="Show Step 4" src="../img/Adjust_20.png" /></br></br></li>
<li>Open the <code>Format SQL</code> in Step 3, scroll to the end and make a copy of the lines between:</br>
<code>// BEGIN: THIS SECTION CAN BE COPIED TO STEP 5 "Format SQL" NODE, ONCE IT WORKS.
:
// END</code></br>
Click <code>Cancel</code>.
<img alt="First Format SQL node" src="../img/Adjust_21.png" /></br></br></li>
<li>Open the <code>Format SQL</code> in Step 5, scroll to the end.</br>
You can see that the content you copied from Step 3 is already there, but now you know the process when experimenting with your own data sets. Just click <code>Cancel</code>.
<img alt="Second Format SQL node" src="../img/Adjust_22.png" /></br></br></li>
<li>It is a good idea to delete the test rows that was injected in Step 3 before injecting the CSV data from the files. Scroll down in the workspace and you will see some additional Step 4 nodes to empty the table (but not removing it), click on the <code>Truncate table</code> inject node.
<img alt="Truncate table" src="../img/Adjust_23.png" /></br></br></li>
<li>It is now time to inject the first small data set of 10 data lines. The file <code>PumpDataSmall.csv</code> will be used for that purpose.</br>
Navigate the the <a href="http://localhost:1880/ui" target="_blank">Node-RED Dashboard</a> and click on <code>Choose file</code> (or <code>Browse...</code> on Windows).
<img alt="Choose file" src="../img/Adjust_30.png" /></br></br></li>
<li>Select <code>PumpDataSmall.csv</code> and press <code>Open</code>.
<img alt="Select file" src="../img/Adjust_31.png" /></br></br></li>
<li>Press the <code>Play</code> button.
<img alt="Run" src="../img/Adjust_32.png" /></br></br></li>
<li>It took 1 second to inject 10 rows of data.
<img alt="Injected 10 rows" src="../img/Adjust_33.png" /></br></br></li>
<li>If that is not the case, then verify that the separator is correct. Open the <code>csv</code> node.
<img alt="csv node" src="../img/Adjust_34.png" /></br></br></li>
<li>Verify that the Separator is the same as that being used in the CSV file.</br>
<code>semicolon</code> is used in the pump csv files.
<img alt="csv separator" src="../img/Adjust_35.png" /></br></br></li>
<li>It is a good idea to disable the two debug nodes before injecting the larger csv file. Click on the green (enabled) button so it become grey (disabled).
<img alt="Disable debug nodes" src="../img/Adjust_40.png" /></br></br></li>
<li>Now it is time to inject the large CSV file. Click on <code>Choose file</code> and open <code>PumpData.csv</code>. 
<img alt="Choose large file" src="../img/Adjust_41.png" /></br></br></li>
<li>Click on the <code>Play</code> button and you will see the progress as data is being injected.
<img alt="Running" src="../img/Adjust_42.png" /></br></br></li>
<li>You have now injected 132479 rows of data in total from the two CSV files :-)
<img alt="Done" src="../img/Adjust_43.png" /></br></br></li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please empty the table when it is no longer being used.</p>
</div>
<hr />
<p>Congratulations you have successfully adjusted and prepared your script as well as injected the data from the two CSV files.</br>
You will now be able to adjust according to your own data sets and inject those data sets into Maximo Monitor - Enjoy!</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../get_script/" class="btn btn-neutral float-left" title="2. Get Node-RED script"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../release_notes/" class="btn btn-neutral float-right" title="Release Notes">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../get_script/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../release_notes/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
